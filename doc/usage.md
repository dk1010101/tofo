# Usage

## Starting the application

At the moment (until proper installer is produced) the easiest way to run the tool
is from the install directory:

```
> python tofo.py
```

You will need to be in the virtual environment you created to install the tool for this to work. Once the tool launches you will first see the splash screen popping up:

![alt text](/images/tofo_800.png "Splash screen asking the user to wait")

which will ask you to wait while the various data files are loaded. If this is the first time you are running the tool, this may take some time. 2-3 minutes is likely but it could be longer as it will depend on your internet connection and on the load on various  external data sources. The initial load will be significantly longer than subsequent ones as all the loaded data is locally cached. Occasionally, initial load may go and fetch new versions of the external data and the frequency of updates is set in the `observatory.yaml` file.

Once the data files have been loaded the splash screen will be replaced with the empty tool window:

![alt text](/images/doc_10.png "Empty main tool window")

The main window has a number of areas and controls that are used to tailor what the tool will show. The top area is the "Observation Date/Time" which contains both local and UTC date/times for observation start (marked with the "1" label in the above) and end ("2" above). The local time is based on the time zone specified in the `observatory.yaml` file and the time zone is shown on the above diagram in line with the Local TIme row. Note that the local time row lables are grayed out - this is because the tool works in UTC and local times are here just for convenience. Changing the local time will automatically update UTC time and vice versa. The end time must always be greater than the start time. The "Apply to All" button (3) is only used when the targets in the area marked with the "4" label have different observation times and the start/end times specified in the "Observation Date/Time" should be used to override those.

Internally the tool uses UTC times for all operations and it is useful to always think in UTC. Time zones are [evil](https://www.zainrizvi.io/blog/falsehoods-programmers-believe-about-time-zones/) as it is and let's not go in to the whole summer time mess. Ergo, UTC (aka Zulu time, if you are militarily minded). Of course, we could all just switch to [consensus time](https://www.xkcd.com/2594/) but until that happens UTC is the way to go. 

The "Targets" are is where all target data will be presented. This area can be populated automatically (see below) or the user can enter targets manually using the "Add Row" (5) and "Del Row" (6) buttons. If a row is added manually, clicking on the "Name" cell and entering the target name will fetch the exoplanet or variable star details and will automatically populate other fields. "UTC Obs Start" and "UTC Obs End" can also be modified. Once targets have been loaded/entered they may (!) appear in the sky visibility plots in the area below (7 and 8). 

"Target Visibility" area is subdivided in to two plots. The first plot (7), looking from the left, shows the whole sky, as if the observer was lying on the ground, looking up with their head pointing north and their feet pointing south. The plot initially shows the horizon as a polygon. Anything inside the polygon is visible and anything outside is not. The second plot (8) shows the same thing but as an Altitude/Azimuth plot. Here it is easier to see the horizon (coloured area) and the sky (everything above all the way up to 90 degrees). At the bottom of the horizontal axes an additional axes is there showing North, East, South and West points and, since this plot wraps around, initially North is both the first and the last point. Underneath plot (8) is a slider that allows changing of the Altitude-Azimuth mid-point. This can be used to rotate the viewpoint and see the horizon and the sky as if looking from a different direction. See the target section below for an example.

Finally, the status bar (10) is used to show which target is selected in either of the visibility plots (7 or 8).

## Loading Targets

Most often targets will either be loaded from a file or they will be autogenerated from the ExoClock database based on the location, horizon, telescope specifications and the observation date/time. The way to do these operations is through the "File" menu:

![alt text](/images/doc_15.png "File pull-down menu")

Loading from the file (1) will ask for a csv file which will then be directly loaded in to the target area of the tool. The file is expected to look as follows:

```
U UMI,2025-01-10T18:00:00,2025-01-11T04:00:00,14:17:20,+66:47:39
UX UMI,2025-01-10T18:00:00,2025-01-11T04:00:00,16:54:28,+83:30:22
HAT-P-56,2025-01-16T18:00:00,2025-01-17T04:00:00,06:43:23.53,+27:15:08.21
Y UMI,2025-01-10T18:00:00,2025-01-11T04:00:00,17:10:35,+83:50:28
Canopus,2025-01-10T18:00:00,2025-01-11T04:00:00,06:23:57,-52:41:44
Deneb,2025-01-10T18:00:00,2025-01-11T04:00:00,20:41:25.91,+45:16:49.2
alpha Cas,2025-01-10T18:00:00,2025-01-11T04:00:00,00:40:30.39,+56:32:14.7
```

The first column will be the target name, ideally something that Simbad will recognise. Second and third columns are the ISO formatted start and end observation times and the last two columns are the RA and DEC of the object in hours/degrees in sexagesimal format.

Alternatively, targets can be loaded from ExoClock database (2, in above). When this option is selected the tool will look at all ExoClock targets that are observable between start and end UTC times specified in the main window. It will also take in to account the location of the observatory, the telescope capabilities as well as the horizon definition and will only list targets that will be actually visible during the transit (+/- the pre/post transit times as specified in the observatory.yaml` file).

The pull-down menu also has the obligatory "Exit" option (3).

## Target View

Once the targets are loaded they will be shown in the main window:

![alt text](/images/doc_20.png "Main window with five exoplanets loaded")

The Targets area will show target details (1) including name, priority and score as well as transit timings. Priority is the ExoClock observation priority while score is tool's own observation priority score betwen 0 (not very interesting) and 1 (super interesting). See [exoplanet score](exo_score.md) for more information. 

It the target was manually entered and it is not visible it will be showed grayed out. Visible targets will also be shown in the "Target Visibility" area (2). Targets will always be represented by coloured arcs denoting the path they will take through the sky. The direction can be inferred from the observation that the sky rotates around the Polaris (more or less) and east to west. 

If the Azimuth mid-point slider is moved, the horizon plot on the right will rotate the viewpoint. Moving the slider to "E" (East) in the above will result in the following view:

![alt text](/images/doc_22.png "Main window with five exoplanets loaded with the horizon view rotated to the East")

It is easy to see that now the view in (1) has changed and that all transits are now visible as uninterrupted arcs.

Note that targets are not labelled. This is by design as usually (especially for large telescopes) there will be many targets visible at any time so the number of targets can easily be 20+ and legend will provide very little information. The easiest way to determine what arc is what target is by clicking on it:

![alt text](/images/doc_30.png "Main window with exoplanets with a target arc being clicked on, on the polar plot")

Clicking on the target (1) will show its name on the status bar (2).

It is possible to click on either plot to select the target:

![alt text](/images/doc_32.png "Main window with exoplanets with a target arc being clicked on, on the alt-az plot")

Note that clicking on the targets in either plot also selects the target in the "Targets" grid above.

Main screen allows examination of the paths the transits will take and rough planning of observations. For example, in the above, we can see that `TOI-1181b` will be getting very close to the horizon towards the end of the transit (the path is arcing under the Polaris so it will be moving West to East and thus we can see that it will touch the horizon at the end of the transit). We can also look at the "T Start" and "T End" times for all transits and see that, in theory, we could record both `TOI-1181b` (starting at 17:49 and ending at 23:54) and `KELT-4Ab` (staring at 23:15 and ending at 04:42). We will have to end the first transit half way through post-egress time and start the second a little late. While this is possible it is worth asking additional questions - what is the possible drift and thus can we take time pre-egress and post-egress and also can the observatory really start imaging at 17:49 or what additional targets are there and are they worth taking. Then there is, of course, weather. In the UK, at least, it is highly unusual to be able to observe over the whole night. Or at all.

An additional possible two-target combination will be `XO-7b` and `WASP-104b` but this pair has very few additional targets.

Another useful thing to notice is that, looking at "Target Visibility" plots we can see where meridian flips will be needed and where they would fall in the transit. A flip will be needed whenever the N-S line in the polar plot or when 0 or 180 azimuth lines are crossed. Since each dot on the plots equals 30 mins it is straight forward to see if flips will be needed during transit start/end times since those time are the worst possible times to not be able to record data. If dots are not visible then it will be tricker (but not impossible) to make this estimate.

## Targets of Opportunity

If you are interested to see what other interesting objects will be visible in the field of view that contains a specific target, double click (1) on the target row number in the Target area.

![alt text](/images/doc_40.png "Main window with four exoplanets loaded")

A popup window will appear (2) which will inform you of the progress of loading other targets. This process may take some time as the tool will work out your telescope field of view, it will project it on to the sky and then it will use external servers to find other interesting objects the fov contains. It will then work out if those objects are variable and if they are it will use their epoch and period to work out if the interesting event will take place at the same time as the target transit. If there will be such and occurrence, the target will be included in the list. If not, it will be excluded. The tool will also download the sky image spanning the fov + 20%. Once all the data is collected a new popup window will appear.

![alt text](/images/doc_50.png "Target of opportunity window")

This windows will show the sky view with targets of interested plotted as points (1). It will also show lots of interesting data about the targets (3) as well as the main target (2). Note that in (3), if a target of opportunity has a number events during the transit time, it will be listed multiple times. 

This example shows an evening when a number of interesting events are visible and, looking at the "Event ISO" column we can see that by observing between 22:57 and 01:07 three events can be recorded - two W Ursae Majoris eclipsing variables and one β Persei-type (Algol) eclipsing system. Looking at the transit details of the main target in (2) we can see that the transit + pre/post times for TOI-1181b range from 17:49 to 23:54 so if the additional events are of interest, the transit session should be extended to after 01:07 so that additional events are covered. 

The dialog also shows that `NSVS 3133546` is outside of the camera FOV but that it has an event that could be captured during the transit and that, thus, if this event is of particular interest, the center of the FOV can be moved to include this event. This will mean that the `ZTF J194855.96+644026.7` will be missed. 

Finally, looking at the main target's magnitude (3) and potential additional target magnitudes (2) we see that, depending on the sensor used, we will have to be careful end working out the exposure times so that we don't saturate the main target while still getting enough from additional targets (mag 10.27 vs eg 14.32) but be careful when comparing magnitudes using different filters, `V` vs `R` vs `r`. As always, astro-imaging is all about compromises.

The information presented on this window can be saved using the "Save" button (3). Clicking on this button will create two files, one with the sky image and one with all the information held in the table.

Clicking on the "Close" button (4) will close this pop-up window.

# Usage

## Starting the application

At the moment (until proper installer is produced) the easiest way to run the tool
is from the install directory:

```
> python tofo.py
```

You will need to be in the virtual environment you created to install the tool for this to work. Once the tool launches you will first see the splash screen popping up:

![alt text](/images/tofo_800.png "Splash screen asking the user to wait")

which will ask you to wait while the various data files are loaded. If this is the first time you are running the tool, this may take some time. 2-3 minutes is likely but it could be longer as it will depend on your internet connection and on the load on various  external data sources. The initial load will be significantly longer than subsequent ones as all the loaded data is locally cached. Occasionally, initial load may go and fetch new versions of the external data and the frequency of updates is set in the `observatory.yaml` file.

Once the data files have been loaded the splash screen will be replaced with the empty tool window:

![alt text](/images/doc_10.png "Empty main tool window")

The main window has a number of areas and controls that are used to tailor what the tool will show. The top area is the "Observation Date/Time" which contains both local and UTC date/times for observation start (marked with the "1" label in the above) and end ("2" above). The local time is based on the time zone specified in the `observatory.yaml` file and the time zone is shown on the above diagram marked with the "3" label. Changing the local time will automatically update UTC time and vice versa. The end time must always be greater than the start time. The "Apply to All" button is only used when the targets in the area marked with the "5" label have different observation times and the start/end times specified in the "Observation Date/Time" should be used to override those.

Internally the tool uses UTC times for all operations and it is useful to always think in UTC. Time zones are evil as it is and let's not go in to the whole summer time mess. Ergo, UTC (aka Zulu time, if you are military minded).

The "Targets" are is where all target data will be presented. This area can be populated automatically (see below) or the user can enter targets manually using the "Add Row" ("6") and "Del Row" ("7") buttons. If a row is added manually, clicking on the "Name" cell and entering the target name will fetch the exoplanet or variable star details and will automatically populate other fields. "UTC Obs Start" and "UTC Obs End" can also be modified. Once targets have been loaded/entered they may (!) appear in the sky visibility plot in the area below (9). 

"Target Visibility" area (9) shows the whole sky, as if the observer was lying on the ground, looking up with their head pointing north and their feet pointing south. The plot initially shows the horizon as a coloured polygon. Anything inside the polygon is visible and anything outside is not. Finally, the status bar (10) is used to show which target is selected in the visibility plot.

## Loading Targets

Most often targets will either be loaded from a file or they will be autogenerated from the ExoClock database based on the location, horizon, telescope specifications and the observation date/time. The way to do these operations is through the "File" menu:

![alt text](/images/doc_15.png "File pull-down menu")

Loading from the file (1) will ask for a csv file which will then be directly loaded in to the target area of the tool. The file is expected to look as follows:

```
U UMI,2025-01-10T18:00:00,2025-01-11T04:00:00,14:17:20,+66:47:39
UX UMI,2025-01-10T18:00:00,2025-01-11T04:00:00,16:54:28,+83:30:22
HAT-P-56,2025-01-16T18:00:00,2025-01-17T04:00:00,06:43:23.53,+27:15:08.21
Y UMI,2025-01-10T18:00:00,2025-01-11T04:00:00,17:10:35,+83:50:28
Canopus,2025-01-10T18:00:00,2025-01-11T04:00:00,06:23:57,-52:41:44
Deneb,2025-01-10T18:00:00,2025-01-11T04:00:00,20:41:25.91,+45:16:49.2
alpha Cas,2025-01-10T18:00:00,2025-01-11T04:00:00,00:40:30.39,+56:32:14.7
```

The first column will be the target name, ideally something that Simbad will recognise. Second and third columns are the ISO formatted start and end observation times and the last two columns are the RA and DEC of the object in hours/degrees in sexagesimal format.

Alternatively, targets can be loaded from ExoClock database (2, in above). When this option is selected the tool will look at all ExoClock targets that are observable between start and end UTC times specified in the main window. It will also take in to account the location of the observatory, the telescope capabilities as well as the horizon definition and will only list targets that will be actually visible during the transit (+/- the pre/post transit times as specified in the observatory.yaml` file).

The pull-down menu also has the obligatory "Exit" option (3).

## Target View

Once the targets are loaded they will be shown in the main window:

![alt text](/images/doc_20.png "Main window with four exoplanets loaded")

The Targets area will show target details (1) including name, priority and score as well as transit timings. Priority is the ExoClock observation priority while score is tool's own observation priority score betwen 0 (not very interesting) and 1 (super interesting). See [exoplanet score](exo_score.md) for more information. 

It the target was manually entered and it is not visible it will be showed grayed out. Visible targets will also be shown in the "Target Visibility" area (2). The will always look like coloured arcs denoting the path they will take through the sky. The direction can be inferred from the observation that the sky rotates around the Polaris (more or less) and east to west. 

Note that targets are not labelled. This is by design as usually (especially for large telescopes) there will be many targets visible at any time so the number of targets can easily be 20+ and legend will provide very little information. The easiest way to determine what arc is what target is by clicking on it:

![alt text](/images/doc_30.png "Main window with exoplanets with a target arc being clicked on")

Clicking on the target (1) will show its name on the status bar (2).

## Targets of Opportunity

If you are interested to see what other interesting objects will be visible in the field of view that contains a specific target, double click (1) on the target row number in the Target area.

![alt text](/images/doc_40.png "Main window with four exoplanets loaded")

A popup window will appear (2) which will inform you of the progress of loading other targets. This process may take some time as the tool will work out your telescope field of view, it will project it on to the sky and then it will use external servers to find other interesting objects the fov contains. It will then work out if those objects are variable and if they are it will use their epoch and period to work out if the interesting event will take place at the same time as the target transit. If there will be such and occurrence, the target will be included in the list. If not, it will be excluded. The tool will also download the sky image spanning the fov + 20%. Once all the data is collected a new popup window will appear.

![alt text](/images/doc_50.png "Target of opportunity window")

This windows will show the sky view with targets of interested plotted as points (1). It will also show lots of interesting data about the targets (2). If the target of opportunity has a number events during the transit time, it will be listed multiple times.

The information presented on this window can be saved using the "Save" button (3). Clicking on this button will create two files, one with the sky image and one with all the information held in the table.

Clicking on the "Close" button (4) will close this pop-up window.
